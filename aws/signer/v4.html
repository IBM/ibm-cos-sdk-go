<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Package: v4
  
    &mdash; IBM COS SDK for Go
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

  <link rel="stylesheet" href="../../css/highlight.github.css" type="text/css" />

<script type="text/javascript">
  pathId = "aws/signer/v4";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../package_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (v)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../aws.html" title="aws (package)">aws</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../signer.html" title="signer (package)">signer</a></span></span>
     &raquo; 
    <span class="title">v4</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="package_list_link"
        href="../../package_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame"></iframe>

      <div id="content">
        <!--REGION_DISCLAIMER_DO_NOT_REMOVE-->
        <h1>Package: v4
  
  
  
</h1>
<div class="package signature">
import "../ibm-cos-sdk-go/aws/signer/v4"
</div>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Package v4 implements signing for AWS V4 signer</p>

<p>Provides request signing for request that need to be signed with AWS V4
Signatures.</p>

<p>Standalone Signer</p>

<p>Generally using the signer outside of the SDK should not require any
additional logic when using Go v1.5 or higher. The signer does this by
taking advantage of the URL.EscapedPath method. If your request URI
requires additional escaping you many need to use the URL.Opaque to define
what the raw URI should be sent to the service as.</p>

<p>The signer will first check the URL.Opaque field, and use its value if set.
The signer does require the URL.Opaque field to be set in the form of:</p>

<pre class="code go"><code class="go"><div class="hljs"><span class="hljs-string">"//<hostname>/<path>"</span>

<span class="hljs-comment">// e.g.</span>
<span class="hljs-string">"//example.com/some/path"</span></div></code></pre>

<p>The leading “//” and hostname are required or the URL.Opaque escaping will
not work correctly.</p>

<p>If URL.Opaque is not set the signer will fallback to the URL.EscapedPath()
method and using the returned value. If you&#39;re using Go v1.4 you must
set URL.Opaque if the URI path needs escaping. If URL.Opaque is not set
with Go v1.5 the signer will fallback to URL.Path.</p>

<p>AWS v4 signature validation requires that the canonical string&#39;s URI
path element must be the URI escaped form of the HTTP request&#39;s path.
<a
href="http://docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html">docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html</a></p>

<p>The Go HTTP client will perform escaping automatically on the request. Some
of these escaping may cause signature validation errors because the HTTP
request differs from the URI path or query that the signature was
generated. <a
href="https://golang.org/pkg/net/url/#URL.EscapedPath">golang.org/pkg/net/url/#URL.EscapedPath</a></p>

<p>Because of this, it is recommended that when using the signer outside of
the SDK that explicitly escaping the request prior to being signed is
preferable, and will help prevent signature validation errors. This can be
done by setting the URL.Opaque or URL.RawPath. The SDK will use URL.Opaque
first and then call URL.EscapedPath() if Opaque is not set.</p>

<p>If signing a request intended for HTTP2 server, and you&#39;re using Go
1.6.2 through 1.7.4 you should use the URL.RawPath as the pre-escaped form
of the request URL. <a
href="https://github.com/golang/go/issues/16847">github.com/golang/go/issues/16847</a>
points to a bug in Go pre 1.8 that fails to make HTTP2 requests using
absolute URL in the HTTP message. URL.Opaque generally will force Go to
make requests with absolute URL. URL.RawPath does not do this, but RawPath
must be a valid escaping of Path or url.EscapedPath will ignore the RawPath
escaping.</p>

<p>Test <code>TestStandaloneSign</code> provides a complete example of using
the signer outside of the SDK and pre-escaping the URI path.</p>


  </div>
</div>
<div class="tags">
  

</div>
  

  
    <h2>Variables</h2>
    
      <dl class="constants">
        
          <dt id="SignRequestHandler-constant" class="">
          <div class="defn">var <strong>SignRequestHandler</strong>  = 
          <span class="note title writeonly">writable</span>
          </div>
            <div class="docstring">
  <div class="discussion">
    
<p>SignRequestHandler is a named request handler the SDK will use to sign
service client request with using the V4 signature.</p>


  </div>
</div>
<div class="tags">
  

</div>
          </dt>
          <dd>
            <h3>Value:</h3>
            <pre class="code"><div class="hljs"><span class='object_link'><a href="../request.html#type-NamedHandler" title="request (package)">request.NamedHandler</a></span>{
	Name: <span class="hljs-string">"<span class='object_link'><a href="#SignRequestHandler-constant" title="aws/signer/v4.SignRequestHandler (constant)">v4.SignRequestHandler</a></span>"</span>, Fn: <span class='object_link'><a href="#SignSDKRequest-class_method" title="v4.SignSDKRequest() (method)">SignSDKRequest</a></span>,
}</div></pre>
          </dd>
        
      </dl>
    
  







  <h2>
    Type Summary
    <small><a href="#" class="summary_toggle">collapse</a></small>
  </h2>

  <ul class="summary">
    
      
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)"><strong>Signer</strong></a></span></span>
  
  
  <span class="note title readonly">struct</span>
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Signer applies AWS v4 signing to given request.</p>
</div></span>
  
</li>


    
      
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="v4/StreamSigner.html" title="v4.StreamSigner (struct)"><strong>StreamSigner</strong></a></span></span>
  
  
  <span class="note title readonly">struct</span>
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>StreamSigner implements signing of event stream encoded payloads.</p>
</div></span>
  
</li>


    
  </ul>



  
    <h2>
      Function  Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#BuildNamedHandler-class_method" title="v4.BuildNamedHandler() (method)">func <strong>BuildNamedHandler</strong>(name string, opts ...func(*Signer)) request.NamedHandler </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>BuildNamedHandler will build a generic handler for signing.</p>
</div></span>
  
</li>


      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#GetSignedRequestSignature-class_method" title="v4.GetSignedRequestSignature() (method)">func <strong>GetSignedRequestSignature</strong>(r *http.Request) ([]byte, error) </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GetSignedRequestSignature attempts to extract the signature of the request.</p>
</div></span>
  
</li>


      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#NewSigner-class_method" title="v4.NewSigner() (method)">func <strong>NewSigner</strong>(credentials *credentials.Credentials, options ...func(*Signer)) *Signer </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>NewSigner returns a Signer pointer configured with the credentials and
optional option values provided.</p>
</div></span>
  
</li>


      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#SignSDKRequest-class_method" title="v4.SignSDKRequest() (method)">func <strong>SignSDKRequest</strong>(req *request.Request) </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>SignSDKRequest signs an AWS request with the V4 signature.</p>
</div></span>
  
</li>


      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#SignSDKRequestWithCurrentTime-class_method" title="v4.SignSDKRequestWithCurrentTime() (method)">func <strong>SignSDKRequestWithCurrentTime</strong>(req *request.Request, curTimeFn func() time.Time, opts ...func(*Signer)) </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>SignSDKRequestWithCurrentTime will sign the SDK&#39;s request using the
time function passed in.</p>
</div></span>
  
</li>


      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#WithUnsignedPayload-class_method" title="v4.WithUnsignedPayload() (method)">func <strong>WithUnsignedPayload</strong>(v4 *Signer) </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>WithUnsignedPayload will enable and set the UnsignedPayload field to true
of the signer.</p>
</div></span>
  
</li>


      
    </ul>
  





  <div id="Function_method_details" class="method_details_list">
    <h2>Function Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="BuildNamedHandler-class_method">
  
    func <strong><span class='object_link'><a href="#BuildNamedHandler-class_method" title="v4.BuildNamedHandler() (method)">BuildNamedHandler</a></span></strong>(name string, opts ...func(*<span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)">Signer</a></span>)) <span class='object_link'><a href="../request.html#type-NamedHandler" title="request (package)">request.NamedHandler</a></span> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>BuildNamedHandler will build a generic handler for signing.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433
434
435
436
437
438</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/v4.go', line 431</span>

<div class="hljs"><span class="hljs-keyword">func</span> BuildNamedHandler(name <span class="hljs-constant">string</span>, opts ...<span class="hljs-keyword">func</span>(*Signer)) request.NamedHandler {
	<span class="hljs-keyword">return</span> request.NamedHandler{
		Name: name,
		Fn: <span class="hljs-keyword">func</span>(req *request.Request) {
			SignSDKRequestWithCurrentTime(req, time.Now, opts...)
		},
	}
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="GetSignedRequestSignature-class_method">
  
    func <strong><span class='object_link'><a href="#GetSignedRequestSignature-class_method" title="v4.GetSignedRequestSignature() (method)">GetSignedRequestSignature</a></span></strong>(r *http.Request) ([]byte, error) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GetSignedRequestSignature attempts to extract the signature of the request.
Returning an error if the request is unsigned, or unable to extract the
signature.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/v4.go', line 553</span>

<div class="hljs"><span class="hljs-keyword">func</span> GetSignedRequestSignature(r *http.Request) ([]byte, <span class="hljs-constant">error</span>) {

	<span class="hljs-keyword">if</span> auth := r.Header.Get(authorizationHeader); len(auth) != 0 {
		ps := strings.Split(auth, <span class="hljs-string">", "</span>)
		<span class="hljs-keyword">for</span> _, p := <span class="hljs-keyword">range</span> ps {
			<span class="hljs-keyword">if</span> idx := strings.Index(p, authHeaderSignatureElem); idx >= 0 {
				sig := p[len(authHeaderSignatureElem):]
				<span class="hljs-keyword">if</span> len(sig) == 0 {
					<span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, fmt.Errorf(<span class="hljs-string">"invalid request signature authorization header"</span>)
				}
				<span class="hljs-keyword">return</span> hex.DecodeString(sig)
			}
		}
	}

	<span class="hljs-keyword">if</span> sig := r.URL.Query().Get(<span class="hljs-string">"X-Amz-Signature"</span>); len(sig) != 0 {
		<span class="hljs-keyword">return</span> hex.DecodeString(sig)
	}

	<span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, fmt.Errorf(<span class="hljs-string">"request not signed"</span>)
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="NewSigner-class_method">
  
    func <strong><span class='object_link'><a href="#NewSigner-class_method" title="v4.NewSigner() (method)">NewSigner</a></span></strong>(credentials *<span class='object_link'><a href="../credentials/Credentials.html" title="credentials.Credentials (struct)">credentials.Credentials</a></span>, options ...func(*<span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)">Signer</a></span>)) *<span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)">Signer</a></span> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>NewSigner returns a Signer pointer configured with the credentials and
optional option values provided. If not options are provided the Signer
will use its default configuration.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/v4.go', line 212</span>

<div class="hljs"><span class="hljs-keyword">func</span> NewSigner(credentials *credentials.Credentials, options ...<span class="hljs-keyword">func</span>(*Signer)) *Signer {
	v4 := &Signer{
		Credentials: credentials,
	}

	<span class="hljs-keyword">for</span> _, option := <span class="hljs-keyword">range</span> options {
		option(v4)
	}

	<span class="hljs-keyword">return</span> v4
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="SignSDKRequest-class_method">
  
    func <strong><span class='object_link'><a href="#SignSDKRequest-class_method" title="v4.SignSDKRequest() (method)">SignSDKRequest</a></span></strong>(req *<span class='object_link'><a href="../request/Request.html" title="request.Request (struct)">request.Request</a></span>) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>SignSDKRequest signs an AWS request with the V4 signature. This request
handler should only be used with the SDK&#39;s built in service
client&#39;s API operation requests.</p>

<p>This function should not be used on its on its own, but in conjunction with
an AWS service client&#39;s API operation call. To sign a standalone
request not created by a service client&#39;s API operation method use the
“Sign” or “Presign” functions of the “Signer” type.</p>

<p>If the credentials of the request&#39;s config are set to
credentials.AnonymousCredentials the request will not be signed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


426
427
428</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/v4.go', line 426</span>

<div class="hljs"><span class="hljs-keyword">func</span> SignSDKRequest(req *request.Request) {
	SignSDKRequestWithCurrentTime(req, time.Now)
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="SignSDKRequestWithCurrentTime-class_method">
  
    func <strong><span class='object_link'><a href="#SignSDKRequestWithCurrentTime-class_method" title="v4.SignSDKRequestWithCurrentTime() (method)">SignSDKRequestWithCurrentTime</a></span></strong>(req *<span class='object_link'><a href="../request/Request.html" title="request.Request (struct)">request.Request</a></span>, curTimeFn func() time.Time, opts ...func(*<span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)">Signer</a></span>)) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>SignSDKRequestWithCurrentTime will sign the SDK&#39;s request using the
time function passed in. Behaves the same as SignSDKRequest with the
exception the request is signed with the value returned by the current time
function.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/v4.go', line 443</span>

<div class="hljs"><span class="hljs-keyword">func</span> SignSDKRequestWithCurrentTime(req *request.Request, curTimeFn <span class="hljs-keyword">func</span>() time.Time, opts ...<span class="hljs-keyword">func</span>(*Signer)) {
	<span class="hljs-comment">// If the request does not need to be signed ignore the signing of the</span>
	<span class="hljs-comment">// request if the AnonymousCredentials object is used.</span>
	<span class="hljs-keyword">if</span> req.Config.Credentials == credentials.AnonymousCredentials {
		<span class="hljs-keyword">return</span>
	}

	region := req.ClientInfo.SigningRegion
	<span class="hljs-keyword">if</span> region == <span class="hljs-string">""</span> {
		region = aws.StringValue(req.Config.Region)
	}

	name := req.ClientInfo.SigningName
	<span class="hljs-keyword">if</span> name == <span class="hljs-string">""</span> {
		name = req.ClientInfo.ServiceName
	}

	v4 := NewSigner(req.Config.Credentials, <span class="hljs-keyword">func</span>(v4 *Signer) {
		v4.Debug = req.Config.LogLevel.Value()
		v4.Logger = req.Config.Logger
		v4.DisableHeaderHoisting = req.NotHoist
		v4.currentTimeFn = curTimeFn
		<span class="hljs-keyword">if</span> name == <span class="hljs-string">"s3"</span> {
			<span class="hljs-comment">// S3 service should not have any escaping applied</span>
			v4.DisableURIPathEscaping = <span class="hljs-constant">true</span>
		}
		<span class="hljs-comment">// Prevents setting the HTTPRequest's Body. Since the Body could be</span>
		<span class="hljs-comment">// wrapped in a custom io.Closer that we do not want to be stompped</span>
		<span class="hljs-comment">// on top of by the signer.</span>
		v4.DisableRequestBodyOverwrite = <span class="hljs-constant">true</span>
	})

	<span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {
		opt(v4)
	}

	curTime := curTimeFn()
	signedHeaders, err := v4.signWithBody(req.HTTPRequest, req.GetBody(),
		name, region, req.ExpireTime, req.ExpireTime > 0, curTime,
	)
	<span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
		req.Error = err
		req.SignedHeaderVals = <span class="hljs-constant">nil</span>
		<span class="hljs-keyword">return</span>
	}

	req.SignedHeaderVals = signedHeaders
	req.LastSignedAt = curTime
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="WithUnsignedPayload-class_method">
  
    func <strong><span class='object_link'><a href="#WithUnsignedPayload-class_method" title="v4.WithUnsignedPayload() (method)">WithUnsignedPayload</a></span></strong>(v4 *<span class='object_link'><a href="v4/Signer.html" title="v4.Signer (struct)">Signer</a></span>) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>WithUnsignedPayload will enable and set the UnsignedPayload field to true
of the signer.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


4
5
6</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/v4/options.go', line 4</span>

<div class="hljs"><span class="hljs-keyword">func</span> WithUnsignedPayload(v4 *Signer) {
	v4.UnsignedPayload = <span class="hljs-constant">true</span>
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
  </div>


      </div>

      <div id="footer">
  Generated on Tue Oct 27 16:28:56 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.3.1).
</div>

<!-- BEGIN-SECTION -->
<script type="text/javascript" src="https://media.amazonwebservices.com/amznUrchin.js"></script>
<!-- SiteCatalyst code version: H.25.2. Copyright 1996-2012 Adobe, Inc. All Rights Reserved.
More info available at http://www.omniture.com -->
<script language="JavaScript" type="text/javascript" src="https://media.amazonwebservices.com/js/sitecatalyst/s_code.min.js">
</script>
<script language="JavaScript" type="text/javascript">
  <!--
  s.prop66='AWS SDK for Go';
  s.eVar66='D=c66';
  s.prop65='API Reference';
  s.eVar65='D=c65';
  var s_code=s.t();if(s_code)document.write(s_code)
  //-->
</script>
<script language="JavaScript" type="text/javascript">
  <!--if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
  //-->
</script>
<noscript>
  <img src="http://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="">
</noscript>
<!--/DO NOT REMOVE/-->
<!-- End SiteCatalyst code version: H.25.2. -->
<!-- END-SECTION -->

    </div>
  </body>
</html>
