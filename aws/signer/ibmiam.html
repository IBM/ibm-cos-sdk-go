<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Package: ibmiam
  
    &mdash; IBM COS SDK for Go
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/highlight.github.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "aws/signer/ibmiam";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../package_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (i)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../aws.html" title="aws (package)">aws</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../signer.html" title="signer (package)">signer</a></span></span>
     &raquo; 
    <span class="title">ibmiam</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="package_list_link"
        href="../../package_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame"></iframe>

      <div id="content">
        <!--REGION_DISCLAIMER_DO_NOT_REMOVE-->
        <h1>Package: ibmiam
  
  
  
</h1>
<div class="package signature">
import "../../../../../../../../../aws/signer/ibmiam"
</div>

  

  
    <h2>Variables</h2>
    
      <dl class="constants">
        
          <dt id="SignRequestHandler-constant" class="">
          <div class="defn">var <strong>SignRequestHandler</strong>  = 
          <span class="note title writeonly">writable</span>
          </div>
            <div class="docstring">
  <div class="discussion">
    <p>SignRequestHandler is a named request handler the SDK will use to sign
service client request with using the IBM IAM signature.</p>


  </div>
</div>
<div class="tags">
  

</div>
          </dt>
          <dd>
            <h3>Value:</h3>
            <pre class="code"><div class="hljs"><span class='object_link'><a href="../request.html#type-NamedHandler" title="request (package)">request.NamedHandler</a></span>{
	Name: signRequestHandlerLog, Fn: <span class='object_link'><a href="#Sign-class_method" title="ibmiam.Sign() (method)">Sign</a></span>,
}</div></pre>
          </dd>
        
      </dl>
    
  









  
    <h2>
      Function  Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#Sign-class_method" title="ibmiam.Sign() (method)">func <strong>Sign</strong>(req *request.Request) </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Sign signs IBM IAM requests with the token type, access token and service instance id request is made to, and time the request is signed at.</p>
</div></span>
  
</li>


      
    </ul>
  





  <div id="Function_method_details" class="method_details_list">
    <h2>Function Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="Sign-class_method">
  
    func <strong><span class='object_link'><a href="#Sign-class_method" title="ibmiam.Sign() (method)">Sign</a></span></strong>(req *<span class='object_link'><a href="../request/Request.html" title="request.Request (struct)">request.Request</a></span>) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Sign signs IBM IAM requests with the token type, access token and service
instance id request is made to, and time the request is signed at.</p>

<p>Returns a list of HTTP headers that were included in the signature or an
error if signing the request failed. Generally for signed requests this value
is not needed as the full request context will be captured by the http.Request
value. It is included for reference though.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/signer/ibmiam/ibmiam.go', line 28</span>

<div class="hljs"><span class="hljs-keyword">func</span> Sign(req *request.Request) {

	<span class="hljs-comment">// Sets the logger for the Request to be signed</span>
	logger := req.Config.Logger
	<span class="hljs-keyword">if</span> !req.Config.LogLevel.Matches(aws.LogDebug) {
		logger = <span class="hljs-constant">nil</span>
	}

	<span class="hljs-comment">// Obtains the IBM IAM Credentials Object</span>
	<span class="hljs-comment">// The objects includes:</span>
	<span class="hljs-comment">//		IBM IAM Token</span>
	<span class="hljs-comment">//		IBM IAM Service Instance ID</span>
	value, err := req.Config.Credentials.Get()
	<span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
		<span class="hljs-keyword">if</span> logger != <span class="hljs-constant">nil</span> {
			logger.Log(debugLog, signRequestHandlerLog, <span class="hljs-string">"CREDENTIAL GET ERROR"</span>, err)
		}
		req.Error = err
		req.SignedHeaderVals = <span class="hljs-constant">nil</span>
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// Check the type of the Token</span>
	<span class="hljs-comment">// If does not exist, return with an error in the request</span>
	<span class="hljs-keyword">if</span> value.TokenType == <span class="hljs-string">""</span> {
		err = errTokenTypeNotSet
		<span class="hljs-keyword">if</span> logger != <span class="hljs-constant">nil</span> {
			logger.Log(debugLog, err)
		}
		req.Error = err
		req.SignedHeaderVals = <span class="hljs-constant">nil</span>
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// Checks the Access Token</span>
	<span class="hljs-comment">// If does not exist, return with an error in the request</span>
	<span class="hljs-keyword">if</span> value.AccessToken == <span class="hljs-string">""</span> {
		err = errAccessTokenNotSet
		<span class="hljs-keyword">if</span> logger != <span class="hljs-constant">nil</span> {
			logger.Log(debugLog, err)
		}
		req.Error = err
		req.SignedHeaderVals = <span class="hljs-constant">nil</span>
		<span class="hljs-keyword">return</span>
	}

	<span class="hljs-comment">// Get the Service Instance ID from the IBM IAM Credentials object</span>
	serviceInstanceID := req.HTTPRequest.Header.Get(<span class="hljs-string">"ibm-service-instance-id"</span>)
	<span class="hljs-keyword">if</span> serviceInstanceID == <span class="hljs-string">""</span> && value.ServiceInstanceID != <span class="hljs-string">""</span> {
		<span class="hljs-comment">// Log the Service Instance ID</span>
		<span class="hljs-keyword">if</span> logger != <span class="hljs-constant">nil</span> {
			logger.Log(debugLog, <span class="hljs-string">"Setting the 'ibm-service-instance-id' from the Credentials"</span>)

		}
		req.HTTPRequest.Header.Set(<span class="hljs-string">"ibm-service-instance-id"</span>, value.ServiceInstanceID)
	}

	<span class="hljs-comment">// Use the IBM IAM Token Bearer as the Authorization Header</span>
	authString := value.TokenType + <span class="hljs-string">" "</span> + value.AccessToken
	req.HTTPRequest.Header.Set(<span class="hljs-string">"Authorization"</span>, authString)
	<span class="hljs-keyword">if</span> logger != <span class="hljs-constant">nil</span> {
		logger.Log(debugLog, signRequestHandlerLog, <span class="hljs-string">"Set Header Authorization"</span>, authString)
	}
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
  </div>


      </div>

      <div id="footer">
  Generated on Thu Mar 28 13:39:52 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.5.1).
</div>

<!-- BEGIN-SECTION -->
<script type="text/javascript" src="https://media.amazonwebservices.com/amznUrchin.js"></script>
<!-- SiteCatalyst code version: H.25.2. Copyright 1996-2012 Adobe, Inc. All Rights Reserved.
More info available at http://www.omniture.com -->
<script language="JavaScript" type="text/javascript" src="https://media.amazonwebservices.com/js/sitecatalyst/s_code.min.js">
</script>
<script language="JavaScript" type="text/javascript">
  <!--
  s.prop66='AWS SDK for Go';
  s.eVar66='D=c66';
  s.prop65='API Reference';
  s.eVar65='D=c65';
  var s_code=s.t();if(s_code)document.write(s_code)
  //-->
</script>
<script language="JavaScript" type="text/javascript">
  <!--if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
  //-->
</script>
<noscript>
  <img src="http://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="">
</noscript>
<!--/DO NOT REMOVE/-->
<!-- End SiteCatalyst code version: H.25.2. -->
<!-- END-SECTION -->

    </div>
  </body>
</html>
