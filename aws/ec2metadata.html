<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Package: ec2metadata
  
    &mdash; IBM COS SDK for Go
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

  <link rel="stylesheet" href="../css/highlight.github.css" type="text/css" />

<script type="text/javascript">
  pathId = "aws/ec2metadata";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../package_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (e)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../aws.html" title="aws (package)">aws</a></span></span>
     &raquo; 
    <span class="title">ec2metadata</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="package_list_link"
        href="../package_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame"></iframe>

      <div id="content">
        <!--REGION_DISCLAIMER_DO_NOT_REMOVE-->
        <h1>Package: ec2metadata
  
  
  
</h1>
<div class="package signature">
import "../ibm-cos-sdk-go/aws/ec2metadata"
</div>
<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Package ec2metadata provides the client for making API calls to the EC2 Metadata service.</p>

<p>This package&#39;s client can be disabled completely by setting the environment variable “AWS_EC2_METADATA_DISABLED=true”. This environment variable set to true instructs the SDK to disable the EC2 Metadata client. The client cannot be used while the environment variable is set to true, (case insensitive).</p>

<p>The endpoint of the EC2 IMDS client can be configured via the environment variable, AWS_EC2_METADATA_SERVICE_ENDPOINT when creating the client with a Session. See aws/session#Options.EC2IMDSEndpoint for more details.</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>Constants</h2>
    
      <dl class="constants">
        
          <dt id="ServiceName-constant" class="">
          <div class="defn">const <strong>ServiceName</strong>  = 
          <span class="note title readonly">readonly</span>
          
          </div>
            <div class="docstring">
  <div class="discussion">
    
<p>ServiceName is the name of the service.</p>


  </div>
</div>
<div class="tags">
  

</div>
          </dt>
          <dd>
            <h3>Value:</h3>
            <pre class="code"><div class="hljs"><span class="hljs-string">"ec2metadata"</span></div></pre>
          </dd>
        
      </dl>
    
  

  







  <h2>
    Type Summary
    <small><a href="#" class="summary_toggle">collapse</a></small>
  </h2>

  <ul class="summary">
    
      
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#type-EC2IAMInfo" title="ec2metadata (package)"><strong>EC2IAMInfo</strong></a></span></span>
  
  
  <span class="note title readonly">struct</span>
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>An EC2IAMInfo provides the shape for unmarshaling an IAM info from the metadata API.</p>
</div></span>
  
</li>


    
      
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#type-EC2InstanceIdentityDocument" title="ec2metadata (package)"><strong>EC2InstanceIdentityDocument</strong></a></span></span>
  
  
  <span class="note title readonly">struct</span>
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>An EC2InstanceIdentityDocument provides the shape for unmarshaling an instance identity document.</p>
</div></span>
  
</li>


    
      
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="ec2metadata/EC2Metadata.html" title="ec2metadata.EC2Metadata (struct)"><strong>EC2Metadata</strong></a></span></span>
  
  
  <span class="note title readonly">struct</span>
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A EC2Metadata is an EC2 Metadata service Client.</p>
</div></span>
  
</li>


    
  </ul>



  
    <h2>
      Function  Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature"><span class='object_link'><a href="#NewClient-class_method" title="ec2metadata.NewClient() (method)">func <strong>NewClient</strong>(cfg aws.Config, handlers request.Handlers, endpoint, signingRegion string, opts ...func(*client.Client)) *EC2Metadata </a></span></span>
  
  
  
  
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>NewClient returns a new EC2Metadata client.</p>
</div></span>
  
</li>


      
    </ul>
  




  <div id="type_details" class="method_details_list">
    <h2>Type Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="type-EC2IAMInfo">
  
    <strong>EC2IAMInfo</strong> struct
  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>An EC2IAMInfo provides the shape for unmarshaling an IAM info from the metadata API</p>


  </div>
</div>
<div class="tags">
  

</div><div class="tags">
<p class="tag_title">Structure Fields:</p>
<dl class="fields">

  <dt><code>
    <strong>Code</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>LastUpdated</strong> time.Time 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>InstanceProfileArn</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>InstanceProfileID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>


</dl>
</div>


</div>
    
      <div class="method_details ">
  <h3 class="signature " id="type-EC2InstanceIdentityDocument">
  
    <strong>EC2InstanceIdentityDocument</strong> struct
  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>An EC2InstanceIdentityDocument provides the shape for unmarshaling an instance identity document</p>


  </div>
</div>
<div class="tags">
  

</div><div class="tags">
<p class="tag_title">Structure Fields:</p>
<dl class="fields">

  <dt><code>
    <strong>DevpayProductCodes</strong> []string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>MarketplaceProductCodes</strong> []string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>AvailabilityZone</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>PrivateIP</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>Version</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>Region</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>InstanceID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>BillingProducts</strong> []string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>InstanceType</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>AccountID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>PendingTime</strong> time.Time 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>ImageID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>KernelID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>RamdiskID</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>

  <dt><code>
    <strong>Architecture</strong> string 
    
    
  </code></dt>
  <dd>
    
    
  </dd>


</dl>
</div>


</div>
    
  </div>


  <div id="Function_method_details" class="method_details_list">
    <h2>Function Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="NewClient-class_method">
  
    func <strong><span class='object_link'><a href="#NewClient-class_method" title="ec2metadata.NewClient() (method)">NewClient</a></span></strong>(cfg <span class='object_link'><a href="Config.html" title="aws.Config (struct)">aws.Config</a></span>, handlers <span class='object_link'><a href="request/Handlers.html" title="request.Handlers (struct)">request.Handlers</a></span>, endpoint, signingRegion string, opts ...func(*<span class='object_link'><a href="client/Client.html" title="client.Client (struct)">client.Client</a></span>)) *<span class='object_link'><a href="ec2metadata/EC2Metadata.html" title="ec2metadata.EC2Metadata (struct)">EC2Metadata</a></span> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>NewClient returns a new EC2Metadata client. Should be used to create a client when not using a session. Generally using just New with a session is preferred.</p>

<p>Will remove the URL path from the endpoint provided to ensure the EC2 IMDS client is able to communicate with the EC2 IMDS API.</p>

<p>If an unmodified HTTP client is provided from the stdlib default, or no client the EC2RoleProvider&#39;s EC2Metadata HTTP client&#39;s timeout will be shortened. To disable this set Config.EC2MetadataDisableTimeoutOverride to false. Enabled by default.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file">// File 'aws/ec2metadata/service.go', line 81</span>

<div class="hljs"><span class="hljs-keyword">func</span> NewClient(cfg aws.Config, handlers request.Handlers, endpo<span class="hljs-constant">int</span>, signingRegion <span class="hljs-constant">string</span>, opts ...<span class="hljs-keyword">func</span>(*client.Client)) *EC2Metadata {
	<span class="hljs-keyword">if</span> !aws.BoolValue(cfg.EC2MetadataDisableTimeoutOverride) && httpClientZero(cfg.HTTPClient) {
		<span class="hljs-comment">// If the http client is unmodified and this feature is not disabled</span>
		<span class="hljs-comment">// set custom timeouts for EC2Metadata requests.</span>
		cfg.HTTPClient = &http.Client{
			<span class="hljs-comment">// use a shorter timeout than default because the metadata</span>
			<span class="hljs-comment">// service is local if it is running, and to fail faster</span>
			<span class="hljs-comment">// if not running on an ec2 instance.</span>
			Timeout: 1 * time.Second,
		}
		<span class="hljs-comment">// max number of retries on the client operation</span>
		cfg.MaxRetries = aws.Int(2)
	}

	<span class="hljs-keyword">if</span> u, err := url.Parse(endpo<span class="hljs-constant">int</span>); err == <span class="hljs-constant">nil</span> {
		<span class="hljs-comment">// Remove path from the endpoint since it will be added by requests.</span>
		<span class="hljs-comment">// This is an artifact of the SDK adding `/latest` to the endpoint for</span>
		<span class="hljs-comment">// EC2 IMDS, but this is now moved to the operation definition.</span>
		u.Path = <span class="hljs-string">""</span>
		u.RawPath = <span class="hljs-string">""</span>
		endpo<span class="hljs-constant">int</span> = u.String()
	}

	svc := &EC2Metadata{
		Client: client.New(
			cfg,
			metadata.ClientInfo{
				ServiceName: ServiceName,
				ServiceID:   ServiceName,
				Endpo<span class="hljs-constant">int</span>:    endpo<span class="hljs-constant">int</span>,
				APIVersion:  <span class="hljs-string">"latest"</span>,
			},
			handlers,
		),
	}

	<span class="hljs-comment">// token provider instance</span>
	tp := newTokenProvider(svc, defaultTTL)

	<span class="hljs-comment">// NamedHandler for fetching token</span>
	svc.Handlers.Sign.PushBackNamed(request.NamedHandler{
		Name: fetchTokenHandlerName,
		Fn:   tp.fetchTokenHandler,
	})
	<span class="hljs-comment">// NamedHandler for enabling token provider</span>
	svc.Handlers.Complete.PushBackNamed(request.NamedHandler{
		Name: enableTokenProviderHandlerName,
		Fn:   tp.enableTokenProviderHandler,
	})

	svc.Handlers.Unmarshal.PushBackNamed(unmarshalHandler)
	svc.Handlers.UnmarshalError.PushBack(unmarshalError)
	svc.Handlers.Validate.Clear()
	svc.Handlers.Validate.PushBack(validateEndpointHandler)

	<span class="hljs-comment">// Disable the EC2 Metadata service if the environment variable is set.</span>
	<span class="hljs-comment">// This short-circuits the service's functionality to always fail to send</span>
	<span class="hljs-comment">// requests.</span>
	<span class="hljs-keyword">if</span> strings.ToLower(os.Getenv(disableServiceEnvVar)) == <span class="hljs-string">"true"</span> {
		svc.Handlers.Send.SwapNamed(request.NamedHandler{
			Name: corehandlers.SendHandler.Name,
			Fn: <span class="hljs-keyword">func</span>(r *request.Request) {
				r.HTTPResponse = &http.Response{
					Header: http.Header{},
				}
				r.Error = awserr.New(
					request.CanceledErrorCode,
					<span class="hljs-string">"EC2 IMDS access disabled via "</span>+disableServiceEnvVar+<span class="hljs-string">" env var"</span>,
					<span class="hljs-constant">nil</span>)
			},
		})
	}

	<span class="hljs-comment">// Add additional options to the service config</span>
	<span class="hljs-keyword">for</span> _, option := <span class="hljs-keyword">range</span> opts {
		option(svc.Client)
	}
	<span class="hljs-keyword">return</span> svc
}</div></pre>
    </td>
  </tr>
</table>

</div>
    
  </div>


      </div>

      <div id="footer">
  Generated on Wed Mar 12 15:46:15 2025 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-2.7.0).
</div>

<!-- BEGIN-SECTION -->
<script type="text/javascript" src="https://media.amazonwebservices.com/amznUrchin.js"></script>
<!-- SiteCatalyst code version: H.25.2. Copyright 1996-2012 Adobe, Inc. All Rights Reserved.
More info available at http://www.omniture.com -->
<script language="JavaScript" type="text/javascript" src="https://media.amazonwebservices.com/js/sitecatalyst/s_code.min.js">
</script>
<script language="JavaScript" type="text/javascript">
  <!--
  s.prop66='AWS SDK for Go';
  s.eVar66='D=c66';
  s.prop65='API Reference';
  s.eVar65='D=c65';
  var s_code=s.t();if(s_code)document.write(s_code)
  //-->
</script>
<script language="JavaScript" type="text/javascript">
  <!--if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
  //-->
</script>
<noscript>
  <img src="http://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="">
</noscript>
<!--/DO NOT REMOVE/-->
<!-- End SiteCatalyst code version: H.25.2. -->
<!-- END-SECTION -->

    </div>
  </body>
</html>
